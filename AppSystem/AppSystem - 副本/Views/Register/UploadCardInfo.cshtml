
@{
    Layout = null;
}


<!DOCTYPE html>
<html>
<head>
    <title>身份证上传</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <link href="~/Scripts/css/style.css" rel="stylesheet" type="text/css" />
    <script src="~/Scripts/js/common.js" type="text/javascript"></script>
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/uploadidcard.js"></script>
    <script src="~/Scripts/upload/mbUploadImg.js"></script>
    <script src="~/Scripts/upload/camera.js"></script>
    <script src="~/Scripts/upload/backuploadImg.js"></script>
    <script type="text/javascript" src="~/Scripts/js/jquery.form.js"></script>
    <script src="~/Scripts/h5upload/ImageResizer.js"></script>
    <script src="~/Scripts/app/serverBase.js"></script>
    <script src="~/Scripts/app/registerinfo.js"></script>
    <script type="text/javascript">
        var Patients = {
            idcard: "",
            name: "",
            sex: "",
            birthday: "",
            address: "",
            nowaddress: "",
            moblie: "",
            facecard: "",
            backcard: "",
           national:""
        }
    </script>

    <script>
        function ChangeCode() {
            var timenow = new Date().getTime();
            var obj = document.getElementById('code');
            if (obj) obj.src = "<>" + timenow;
        }

    </script>
</head>
<body>
    <form id="uploadForm" action='@Url.Action("UploadFile","Register")' method="post" enctype="multipart/form-data">
        <!--顶部开始--><div id="top">
                       <input type="hidden" id="idcard" />
        <input type="hidden" id="national" />

            <!--频道导航 开始-->
            <script>
                window.onload = function () {
                    var oWin = document.getElementById("window");
                    var oLay = document.getElementById("overlay");
                    var oBtn = document.getElementById("popmenu");
                    var oClose = document.getElementById("close");
                    oBtn.onclick = function () { oLay.style.display = "block"; oWin.style.display = "block" };
                    oLay.onclick = function () { oLay.style.display = "none"; oWin.style.display = "none" }
                };

            </script><div style="margin-bottom:55px;"><div id="toolbar"><div class="fixed-green"><a class="ui-title" id="popmenu">上传身份证</a><a class="ui-btn-back" href="javascript:history.go(-1)"></a><a class="ui-btn-home" href="/"></a></div></div><div id="overlay"></div><div id="window"><ul class="windowlist"><li><a href="/"><span>网站首页</span></a></li><div class="clear"></div></ul></div></div><!--频道导航 结束-->
        </div><!--顶部结束--><div id="content">
            <div class="guestbook">
                <ul class="wxlist">
                    <li>
                        <div class="ChannelName"><h1>上传正面身份证</h1></div>
                        <table border="0" cellpadding="0" cellspacing="3" class="guestbooktable">
                            <tr>
                                <td height="300px">
                                    <p id="facepreview"></p>
                                </td>
                            </tr>
                            <tr>
                                <td class="t1">
                                    <span class="required">
                                        <input type="file" class="ui-btn-submit" accept="image/*" id="faceupload" capture="camera" value="上传正面身份证">
                                    </span>
                            </tr>
                        </table>
                        <div class="ChannelName"><h1>上传背面身份证</h1></div>
                        <table border="0" cellpadding="0" cellspacing="3" class="guestbooktable">
                            <tr>
                                <td height="300px">
                                    <p id="backpreview"></p>
                                </td>
                            </tr>
                            <tr>
                                <td class="t1" style="width:90%" colspan="3">
                                    <span class="required">
                                        <input type="file" class="ui-btn-submit" accept="image/*" id="backeupload" capture="camera" value="上传背面身份证">
                                    </span>
                            </tr>
                            <tr><td class="t1">姓名</td>
                            <td class="t2">
                                <input id="name"  type="text" maxlength="100" value="" />
                            </td>
                            </tr>
                            <tr>
                                <td class="t1">性别</td>
                                <td class="t2">
                                    <input id="sex" type="text" maxlength="100" value="" />
                                </td>
                            </tr>
                            <tr>
                                <td class="t1">出生日期</td>
                                <td class="t2">
                                    <input id="birth"type="text" maxlength="100" value="" />
                                </td>
                            </tr>
                            <tr>
                                <td class="t1">地址</td>
                                <td class="t2">
                                    <input id="address" type="text" maxlength="100" value="" />
                                </td>
                            </tr>
                            <tr>
                                <td class="t1">家庭住址</td>
                                <td class="t2">
                                    <input id="faddress" type="text" maxlength="100" value="" />
                                </td>
                            </tr>
                            <tr>
                                <td class="t1">手机号码</td>
                                <td class="t2">
                                    <input id="mobilep"  type="text" maxlength="100" value="" />
                                </td>
                            </tr>
                            <tr><td colspan="2"><input class="ui-btn-submit" type="button" id="backsubmit" value="提交" /></tr>
                        </table>
                        <input type="hidden" name="__hash__" value="20e9069c074db1487c38924f89012b3f_b88e23258e1340f488f4b0c6cf9116f3" />
                    </li>
                </ul>
            </div>
            <input type="hidden" id="types" />
        </div><!--页脚开始--><div id="footer">
            <!-- 微信分享导引 开始-->
            <script>
                function openGuide() { document.getElementById('guide').style.display = 'block'; }

                function closeGuide() { document.getElementById('guide').style.display = ''; }

            </script><div id="guide" onClick=" closeGuide()"><img src="images/guide.png"></div><!-- 微信分享导引 结束--><!--快捷按钮 开始--><div class="plug-div"><div class="plug-phone"><div class="plug-menu themeStyle"><span class="close"></span></div><div class="themeStyle plug-btn plug-btn1 close"><a href="/"><span style="background-image: url(ky_img/home.png);"></span></a></div><div class="themeStyle plug-btn plug-btn2 close"><a href="Contact.html"><span style="background-image: url(ky_img/tel.png);"></span></a></div><div class="themeStyle plug-btn plug-btn3 close"><a href="About.html"><span style="background-image: url(ky_img/aboutus.png);"></span></a></div><div class="themeStyle plug-btn plug-btn4 close"><a href="Message.html"><span style="background-image: url(ky_img/guestbook.png);"></span></a></div><div class="plug-btn plug-btn5 close"></div></div></div><!--快捷按钮 结束--><div><ul class="wxlist"><a href="#top"><li><div class="GoTop"><img src="~/Scripts/images/top.png" />回顶部</div></li></a></ul></div>   <div class="copyright">

            </div>
            <script>
                var picString;
                var faceupload = document.getElementById('faceupload'),
                 facepreview = document.getElementById('facepreview');

                var backeupload = document.getElementById('backeupload'),
                 backpreview = document.getElementById('backpreview');
                faceupload.addEventListener('change', mbUploadImg.handleFile, false);
                backeupload.addEventListener('change', bkmbUploadImg.handleFile, false);
                mbUploadImg.init({
                    changeSize: true,
                    maxWidth: 500,
                    maxHeight: 500,
                    imgHandle: function (src) {
                        facepreview.innerHTML = '<img id="faceimg" src="' + src + '" />';
                        picString = src;
                        UploadFile(src, 0);
                    }
                })
                bkmbUploadImg.init({
                    changeSize: true,
                    maxWidth: 500,
                    maxHeight: 500,
                    imgHandle: function (src) {
                        backpreview.innerHTML = '<img src="' + src + '" />';
                        picString = src;
                        UploadFile(src, 1);
                    }
                })
                var arrayImg = ",";//图片base64值
                function SetValue() {
                    arrayImg = ",";
                    arrayImg = arrayImg + picString + ",";
                } var array = new Array();
                var facecardimg = "";
                var backcardimg = "";
                function UploadFile(src, type) {
                    SetValue();
                    var reg = new RegExp("data:image/jpeg;base64,", "g");//创建正则RegExp对象
                    var imgStr = arrayImg;
                    var imgStr = imgStr.replace(reg, "");//替换多余的头文信息
                    array = new Array();
                    //去掉第一个逗号
                    if (imgStr.substr(0, 1) == ',') imgStr = imgStr.substr(1);
                    //去掉最后一个逗号
                    var reg = /,$/gi;
                    imgStr = imgStr.replace(reg, "");
                    
                    array = imgStr.split(",");
                    var imgCount = array.length;

                    for (var i = 0; i < imgCount; i++) {
                        $.ajax({
                            type: "POST",
                            url: "@Url.Action("UploadFile", "Register")",
                            data: { data: array[i], type: type },
                            async: false,
                            success: function (src) {
                                if (src.config_str.indexOf("face") > 0) {
                                    if (src.name == "" || src.name == null) {
                                        alert("身份认证失败，请重新上传！");
                                        return;
                                    }
                                    $("#name").val(src.name);
                                    $("#sex").val(src.sex);
                                    $("#birth").val(src.birth);
                                    $("#address").val(src.address);
                                    $("#idcard").val(src.num);
                                    $("#national").val(src.nationality);
                                    facecardimg = array[i];
                                }
                                else {
                                    backcardimg = array[i];
                                }
                              
                            }
                        });
                    }
                }
            </script>
        </div><!--页脚结束-->
    </form>
</body>
</html>